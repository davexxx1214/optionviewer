# ç¾è‚¡æœŸæƒåˆ†æè¯„åˆ†ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºNode.jsçš„ç¾è‚¡æœŸæƒåˆ†æè¯„åˆ†ç³»ç»Ÿï¼Œé›†æˆAlphaVantage APIè·å–å®æ—¶æ•°æ®ï¼Œæä¾›åŸºäºå†å²åŸºå‡†çš„æ™ºèƒ½æœŸæƒåˆ†æã€‚

## æ ¸å¿ƒåŠŸèƒ½

- **å®æ—¶æ•°æ®**: AlphaVantage APIé›†æˆ (è‚¡ç¥¨ä»·æ ¼ + æœŸæƒé“¾ + å†å²æ•°æ®)
- **NVDAå†å²åŸºå‡†**: åŠå¹´126ä¸ªäº¤æ˜“æ—¥å†å²IVåŸºå‡†æ•°æ®ï¼ŒæŒ‰DTEåŒºé—´åˆ†ç»„
- **æ™ºèƒ½HVåˆ†æ®µ**: åŸºäºæœŸæƒå‰©ä½™å¤©æ•°çš„åˆ†æ®µå†å²æ³¢åŠ¨ç‡è®¡ç®—
- **ä¸‰é‡è¿‡æ»¤**: æµåŠ¨æ€§/ä»·å·®/IVåˆç†æ€§è¿‡æ»¤æœºåˆ¶
- **åŸºå‡†æ¯”è¾ƒ**: å½“å‰IVä¸å†å²åŸºå‡†IVçš„æ¯”è¾ƒåˆ†æ
- **25åªè‚¡ç¥¨**: ç¾è‚¡å‰20 + 5åªä¸­æ¦‚è‚¡æ”¯æŒ
- **ç°ä»£åŒ–UI**: æ·±è‰²ä¸»é¢˜ï¼Œå“åº”å¼è®¾è®¡

## æŠ€æœ¯æ¶æ„

```
åç«¯: Node.js + Express
å‰ç«¯: åŸç”ŸHTML/CSS/JavaScript  
æ•°æ®æº: AlphaVantage API
ç¼“å­˜: 5åˆ†é’Ÿå†…å­˜ç¼“å­˜
å¤‡é€‰: APIå¤±è´¥æ—¶Mockæ•°æ®
```

## é¡¹ç›®ç»“æ„

```
optionviewer/
â”œâ”€â”€ server.js              # ExpressæœåŠ¡å™¨å…¥å£
â”œâ”€â”€ routes/api.js          # APIè·¯ç”±
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ alphavantage.js    # AlphaVantage APIæœåŠ¡
â”‚   â”œâ”€â”€ nvda-historical-benchmark.js  # NVDAå†å²åŸºå‡†æ•°æ®è®¡ç®—
â”‚   â”œâ”€â”€ hv-cache.js        # HVç¼“å­˜ç®¡ç†
â”‚   â””â”€â”€ price-cache.js     # ä»·æ ¼ç¼“å­˜ç®¡ç†
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ benchmarks.js      # åˆ†æ®µHVæ•°æ® + ä¼ ç»ŸåŸºå‡†
â”‚   â””â”€â”€ filters.js         # æœŸæƒè¿‡æ»¤å™¨é…ç½®
â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ nvda-historical-benchmarks.json  # NVDAåŠå¹´å†å²åŸºå‡†
â”‚   â””â”€â”€ nvda-raw-historical-data.json    # NVDAåŸå§‹å†å²æ•°æ®
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ stocks-config.js   # æ”¯æŒçš„è‚¡ç¥¨åˆ—è¡¨
â”‚   â””â”€â”€ mock-data.js       # Mockæ•°æ®ç”Ÿæˆé€»è¾‘
â””â”€â”€ public/                # å‰ç«¯é™æ€æ–‡ä»¶
```

## å…³é”®æŠ€æœ¯å®ç°

### 1. åˆ†æ®µå†å²æ³¢åŠ¨ç‡ (HV)

**åŸºäºæœŸæƒå‰©ä½™å¤©æ•°(DTE)çš„æ™ºèƒ½åˆ†æ®µ**:

| åˆ†æ®µ | DTEèŒƒå›´ | HVå‘¨æœŸ | ç”¨é€” |
|------|---------|--------|------|
| è¶…çŸ­æœŸ | 0-20å¤© | 20å¤© | çŸ­æœŸæ³¢åŠ¨åæ˜ å½“å‰å¸‚å†µ |
| çŸ­æœŸ | 21-60å¤© | 30å¤© | å¹³è¡¡æ³¢åŠ¨æ€§ä¸ç»Ÿè®¡æœ‰æ•ˆæ€§ |
| ä¸­æœŸ | 61-180å¤© | 60å¤© | ç¨³å®šçš„æ³¢åŠ¨ç‡ä¼°è®¡ |
| é•¿æœŸ | >180å¤© | 180å¤© | é•¿æœŸåŸºç¡€èµ„äº§ç‰¹å¾ |

**å®ç°ä½ç½®**: `config/benchmarks.js` - `getSegmentedHV(symbol, daysToExpiry)`

### 2. NVDAå†å²åŸºå‡†ç³»ç»Ÿ

**æ•°æ®è®¡ç®—**:
```javascript
// ç­–ç•¥B: é€æ—¥å†å²æœŸæƒæ•°æ®è·å–
å†å²æœŸé—´: 126ä¸ªäº¤æ˜“æ—¥ (åŠå¹´)
æ•°æ®æ¥æº: AlphaVantage HISTORICAL_OPTIONS API
åŒºé—´åˆ’åˆ†: æŒ‰DTEåˆ†ä¸º4ä¸ªåŒºé—´
åŸºå‡†è®¡ç®—: æ¯ä¸ªåŒºé—´çš„å¹³å‡IVå€¼
```

**DTEåŒºé—´åˆ†ç»„**:
| åŒºé—´ | DTEèŒƒå›´ | ç”¨é€” |
|------|---------|------|
| ultra_short | 0-20å¤© | çŸ­æœŸæœŸæƒåŸºå‡† |
| short | 21-60å¤© | æ ‡å‡†æœˆåº¦æœŸæƒ |
| medium | 61-180å¤© | å­£åº¦æœŸæƒ |
| long | >180å¤© | LEAPSé•¿æœŸæœŸæƒ |

**åŸºå‡†æ¯”è¾ƒ**:
```javascript
ratio = currentIV / benchmarkIV
if (ratio > 1.2) â†’ "é«˜äºå†å²åŸºå‡†20%+"
if (ratio < 0.8) â†’ "ä½äºå†å²åŸºå‡†20%+"
else â†’ "æ­£å¸¸èŒƒå›´"
```

### 3. ä¸‰é‡è¿‡æ»¤æœºåˆ¶

```javascript
// config/filters.js
liquidity: volume > 10 && openInterest > 100
bidAskSpread: (ask - bid) / ask < 0.10
ivSanity: iv > 0.15 && iv < 2.00
```

### 4. æ•°æ®æºç®¡ç†

**å®æ—¶æ•°æ®**:
- è‚¡ç¥¨ä»·æ ¼: `TIME_SERIES_INTRADAY` (5åˆ†é’Ÿ)
- æœŸæƒé“¾: `ANALYTICS_FIXED_WINDOW` 
- å†å²æ•°æ®: `TIME_SERIES_DAILY_ADJUSTED`

**å†å²åŸºå‡†æ•°æ®**:
- NVDA: 126ä¸ªäº¤æ˜“æ—¥çœŸå®å†å²IVåŸºå‡† (æŒ‰DTEåŒºé—´)
- å…¶ä»–è‚¡ç¥¨: MockåŸºå‡†æ•°æ® (å¾…æ‰©å±•)
- åˆ†æ®µHVåŸºå‡†: æ¯åªè‚¡ç¥¨4æ®µHVæ•°æ®
- å¤‡é€‰æœŸæƒæ•°æ®: APIå¤±è´¥æ—¶ä½¿ç”¨

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®
```bash
npm install
cp .env.example .env
# ç¼–è¾‘ .envï¼Œæ·»åŠ  ALPHAVANTAGE_API_KEY
```

### 2. å¯åŠ¨æœåŠ¡
```bash
npm start  # ç”Ÿäº§æ¨¡å¼
npm run dev  # å¼€å‘æ¨¡å¼
```

### 3. è®¿é—®åº”ç”¨
```
http://localhost:3000
```

## APIæ¥å£

### è·å–æœŸæƒæ•°æ®
```http
GET /api/options/{symbol}?type={call|put}&days={30|60|90}

å“åº” (NVDAç¤ºä¾‹):
{
  "success": true,
  "data": {
    "stock": { è‚¡ç¥¨ä¿¡æ¯ },
    "options": [
      {
        "symbol": "NVDA",
        "daysToExpiry": 25,
        "historicalVolatility": "27.51",  // åˆ†æ®µHV
        "hvPeriod": 30,                   // HVè®¡ç®—å‘¨æœŸ
        "impliedVolatility": "32.45",
        "ivHvRatio": "1.18",
        "filterStatus": "åˆæ ¼æœŸæƒ",
        "isQualified": true,
        "benchmarkAnalysis": {            // æ–°å¢: åŸºå‡†åˆ†æ
          "category": "short",
          "currentIV": "32.45%",
          "benchmarkIV": "71.45%", 
          "ratio": "0.45",
          "comparison": "low",
          "sampleCount": 2086
        }
      }
    ]
  }
}
```

### NVDAåŸºå‡†æ•°æ®ç®¡ç†
```http
GET /api/benchmark/nvda/update     # æ›´æ–°NVDAåŸºå‡†æ•°æ® (SSE)
GET /api/benchmark/nvda/data       # è·å–NVDAåŸºå‡†æ•°æ®
GET /api/benchmark/nvda/status     # è·å–åŸºå‡†çŠ¶æ€
```

## æ”¯æŒçš„è‚¡ç¥¨

**ç¾è‚¡å‰20**: NVDA, MSFT, AAPL, AMZN, GOOGL, META, AVGO, TSLA, BRK-B, JPM, WMT, LLY, V, ORCL, MA, NFLX, XOM, COST, JNJ, HD

**ä¸­æ¦‚è‚¡5åª**: BABA, PDD, NTES, JD, TME

## é…ç½®æ–‡ä»¶

### æœŸæƒè¿‡æ»¤å™¨é…ç½®
```javascript
// config/filters.js
const FILTER_CONFIG = {
  MIN_DAILY_VOLUME: 10,
  MIN_OPEN_INTEREST: 100,
  MAX_BID_ASK_SPREAD_PERCENT: 10,
  MIN_IMPLIED_VOLATILITY_PERCENT: 15,
  MAX_IMPLIED_VOLATILITY_PERCENT: 200
};
```

### VVIå†å²åŸºå‡†é…ç½®
```javascript
// config/benchmarks.js
const HISTORICAL_BENCHMARKS = {
  'AAPL': { 
    R_avg: 0.85, R_std_dev: 0.08,
    HV_segments: {
      ultra_short: 27.5, short: 25.8,
      medium: 24.2, long: 22.8
    }
  },
  // ... å…¶ä»–24åªè‚¡ç¥¨
};
```

## æ•°æ®è¯´æ˜

### çœŸå®æ•°æ®
- âœ… è‚¡ç¥¨ä»·æ ¼ (AlphaVantage)
- âœ… æœŸæƒé“¾æ•°æ® (AlphaVantage)  
- âœ… å†å²ä»·æ ¼ (AlphaVantage)
- âœ… è¿‡æ»¤å™¨é…ç½® (å¯é…ç½®)

### Mockæ•°æ®
- ğŸ“Š VVIå†å²åŸºå‡† (25åªè‚¡ç¥¨çš„R_avg, R_std_dev)
- ğŸ“Š åˆ†æ®µHVåŸºå‡† (æ¯è‚¡ç¥¨4æ®µHVæ•°æ®)
- ğŸ”„ å¤‡é€‰æœŸæƒæ•°æ® (APIå¤±è´¥æ—¶)

### æ··åˆè®¡ç®—
- ğŸ¯ NVDAåŸºå‡†åˆ†æ: çœŸå®å†å²IVåŸºå‡† + å½“å‰IVæ¯”è¾ƒ
- ğŸ¯ åˆ†æ®µHV: MockåŸºå‡†æ•°æ® + åŸºäºDTEçš„æ™ºèƒ½é€‰æ‹©
- ğŸ¯ å…¶ä»–è‚¡ç¥¨: ä¼ ç»ŸMockåŸºå‡† + å½“å‰HV/IV

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°è‚¡ç¥¨
1. åœ¨ `data/stocks-config.js` æ·»åŠ è‚¡ç¥¨ä¿¡æ¯
2. åœ¨ `config/benchmarks.js` æ·»åŠ å†å²åŸºå‡†æ•°æ®
3. é‡å¯æœåŠ¡å™¨

### ä¿®æ”¹è¿‡æ»¤å™¨
ç¼–è¾‘ `config/filters.js` ä¸­çš„ `FILTER_CONFIG`

### æ›´æ–°NVDAåŸºå‡†
é€šè¿‡ `/api/benchmark/nvda/update` é‡æ–°è®¡ç®—å†å²åŸºå‡†

### æ‰©å±•å…¶ä»–è‚¡ç¥¨åŸºå‡†
å‚è€ƒ `services/nvda-historical-benchmark.js` å®ç°å…¶ä»–è‚¡ç¥¨çš„å†å²åŸºå‡†è®¡ç®—

## æ³¨æ„äº‹é¡¹

- AlphaVantageå…è´¹ç‰ˆæœ‰APIé™åˆ¶ (5 calls/min, 100 calls/day)
- ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°Mockæ•°æ®
- è‚¡ç¥¨ä»·æ ¼ç¼“å­˜5åˆ†é’Ÿ
- ä»…ä¾›æ•™è‚²å’Œç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®

## ç‰ˆæœ¬ä¿¡æ¯

å½“å‰ç‰ˆæœ¬: v2.0 - å†å²åŸºå‡†ç‰ˆ
- âœ… NVDAåŠå¹´å†å²åŸºå‡†æ•°æ®è®¡ç®— (126ä¸ªäº¤æ˜“æ—¥)
- âœ… æŒ‰DTEåŒºé—´åˆ†ç»„çš„IVåŸºå‡†å¯¹æ¯”
- âœ… çœŸå®å†å²æœŸæƒæ•°æ®è·å–å’Œå¤„ç†
- âœ… åˆ†æ®µHVè®¡ç®—ç³»ç»Ÿ
- âœ… ä¸‰é‡è¿‡æ»¤æœºåˆ¶
- âœ… 25åªè‚¡ç¥¨æ”¯æŒ
- âœ… ç°ä»£åŒ–UI

## å½“å‰å·¥ä½œçŠ¶æ€

**âœ… å·²å®Œæˆ**:
1. NVDAå†å²åŸºå‡†æ•°æ®ç³»ç»Ÿå®Œæ•´å®ç°
2. AlphaVantage HISTORICAL_OPTIONS APIé›†æˆ
3. ç­–ç•¥B: é€æ—¥å†å²æ•°æ®è·å–å’ŒIVåŸºå‡†è®¡ç®—
4. DTEè®¡ç®—ä¿®å¤ (å†å²æ—¥æœŸvsä»Šæ—¥æ—¥æœŸ)
5. å­—æ®µåç§°å…¼å®¹æ€§å¤„ç† (implied_volatility vs impliedVolatility)
6. åŸºå‡†æ¯”è¾ƒåˆ†æé›†æˆåˆ°æœŸæƒåˆ†ææµç¨‹

**ğŸ”„ å½“å‰é—®é¢˜**:
- ~~IVæ˜¾ç¤ºä¸º0~~ âœ… å·²è§£å†³ (å­—æ®µåç§°ä¸ä¸€è‡´é—®é¢˜)
- ~~æœŸæƒè¢«æ ‡è®°ä¸ºå·²è¿‡æœŸ~~ âœ… å·²è§£å†³ (DTEè®¡ç®—é”™è¯¯)
- ~~åŸºå‡†æ•°æ®æœªä¿å­˜~~ âœ… å·²è§£å†³ (saveBenchmarkDataå‚æ•°é—®é¢˜)

**ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ**:
1. æ‰©å±•å†å²åŸºå‡†åˆ°å…¶ä»–çƒ­é—¨è‚¡ç¥¨ (AAPL, MSFT, TSLAç­‰)
2. ä¼˜åŒ–APIè°ƒç”¨é¢‘ç‡æ§åˆ¶ (å½“å‰75æ¬¡/åˆ†é’Ÿé™åˆ¶)
3. å‰ç«¯UIå¢å¼º: åŸºå‡†åˆ†æç»“æœå¯è§†åŒ–
4. æ·»åŠ åŸºå‡†æ•°æ®çš„æ—¶æ•ˆæ€§ç®¡ç† (å®šæœŸæ›´æ–°)
5. å®ç°åŸºå‡†æ•°æ®çš„å¢é‡æ›´æ–°æœºåˆ¶

---

**ğŸ’¡ AIå¼€å‘è€…æç¤º**: 
- NVDAåŸºå‡†ç³»ç»Ÿåœ¨ `services/nvda-historical-benchmark.js`
- åŸºå‡†æ•°æ®å­˜å‚¨åœ¨ `cache/nvda-historical-benchmarks.json`
- æœŸæƒåˆ†æé›†æˆåœ¨ `data/mock-data.js` getRealOptionsData()
- APIè·¯ç”±åŸºå‡†æ•°æ®åŠ è½½åœ¨ `routes/api.js`
- å¯ç›´æ¥å¤åˆ¶NVDAæ¨¡å¼æ‰©å±•åˆ°å…¶ä»–è‚¡ç¥¨